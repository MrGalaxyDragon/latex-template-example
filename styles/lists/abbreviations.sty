\ProvidesPackage{styles/lists/abbreviations}

\RequirePackage{acro}

\acsetup{make-links}

\ExplSyntaxOn

\clist_set:Nn \l_cases_clist {genitivesg,dativesg,accusativesg,genitivepl,dativepl,accusativepl}

\clist_map_inline:Nn \l_cases_clist
{
    \DeclareAcroEnding{#1}{}{}

    \expandafter\NewAcroCommand\csname ac#1\endcsname{m}{\csname acro#1\endcsname\UseAcroTemplate{first}{##1}}
    \expandafter\NewAcroCommand\csname acs#1\endcsname{m}{\csname acro#1\endcsname\UseAcroTemplate{short}{##1}}
    \expandafter\NewAcroCommand\csname acl#1\endcsname{m}{\csname acro#1\endcsname\UseAcroTemplate{long}{##1}}
    \expandafter\NewAcroCommand\csname acf#1\endcsname{m}{%
        \acrofull%
        \csname acro#1\endcsname%
        \UseAcroTemplate{first}{##1}%
    }
    \expandafter\NewAcroCommand\csname iacs#1\endcsname{m}{%
        \acroindefinite%
        \csname acro#1\endcsname%
        \UseAcroTemplate{short}{##1}%
    }
}

\ExplSyntaxOff

\DeclareAcroProperty{foreign-short}

\ExplSyntaxOn

\NewAcroTemplate{foreignshort}{\acrowrite{foreign-short}}
\NewAcroCommand\acforeignshort{m}{\UseAcroTemplate{foreignshort}{#1}}

\ExplSyntaxOff

\newcommand{\acronymlength}{5.5}
\newcommand{\acronympadding}{0.5}
\edef\acronymspace{\fpeval{\acronymlength + \acronympadding}}

\NewAcroTemplate[list]{custom}{
    \acroheading
    \acropreamble
    \begin{description}[
        labelwidth = \acronymlength em ,
        leftmargin = \acronymspace em ,
        noitemsep ,
        itemindent = 0pt]
        \acronymsmapF{%
            \item[\acrowrite{short}\acroifT{alt}{/}\acrowrite{alt}]%
            \acrowrite{list}%
            \acroifT{foreign}{%
                    { }(\acrowrite{foreign}\acroifT{foreign-short}{{ }(\acrowrite{foreign-short})})%
            }%
        }
        { \item \AcroRerun }%
    \end{description}%
}

\acsetup{
    list/template = custom
}

\newif\ifacronyms

\let\OldDeclareAcronym\DeclareAcronym
\renewcommand{\DeclareAcronym}[2]{%
    \acronymstrue%
    \OldDeclareAcronym{#1}{#2}%
}